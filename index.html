<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>煲養日記｜互動式拍攝腳本儀表板 (完整編輯版)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Hearth (Beige, Warm Grey, Soft Terracotta Accent) -->
    <!-- Application Structure Plan: An SPA dashboard with a card-local "Edit Mode" and localStorage persistence. A persistent top section shows a prep checklist and schedule. The main interface uses tabs to switch between weeks, with an option to add new weeks. All changes to scripts, schedules, and week structures are saved to localStorage on "Save" and reloaded on page visit, ensuring user work is not lost. A "Reset" button is provided to clear localStorage and revert to the default template. -->
    <!-- Visualization & Content Choices: 
        - LocalStorage Persistence: Goal: Persist Data -> Method: JSON.stringify to save the main data object to localStorage on edit/add actions, and JSON.parse to load on initial startup -> Justification: The key feature to make user edits durable across sessions.
        - Editable Elements: Goal: Edit -> Method: JS toggling of `contenteditable` attribute on a per-card basis -> Interaction: Card-specific 'Edit' button activates the mode -> Justification: Prevents accidental edits.
        - Dynamic DOM Manipulation: Goal: Add/Delete -> Method: JS functions to create/remove dialogue nodes (visible only in edit mode), which are then saved to the main data object. -> Justification: Intuitive script structure modification.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #FDF8F2;
        }
        .main-nav-btn {
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }
        .main-nav-btn.active {
            border-bottom-color: #D57A66;
            color: #4A4A4A;
        }
        .week-nav-btn {
            transition: all 0.3s ease;
        }
        .week-nav-btn.active {
            background-color: #D57A66;
            color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .content-card {
            background-color: #FFFFFF;
            border-radius: 0.75rem;
            border: 1px solid #E5E7EB;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05);
        }
        .dialogue-number {
            min-width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #F7EFE5;
            color: #D57A66;
            border-radius: 50%;
            font-weight: 700;
        }
        .gemini-btn, .edit-btn-main {
            background-color: #E3A092;
            color: white;
        }
        .gemini-btn:hover, .edit-btn-main:hover {
            background-color: #D57A66;
        }
        .save-btn { background-color: #4ADE80; color: white; }
        .save-btn:hover { background-color: #22C55E; }
        .cancel-btn { background-color: #FBBF24; color: white; }
        .cancel-btn:hover { background-color: #F59E0B; }
        .delete-btn { background-color: #f87171; color: white; }
        .delete-btn:hover { background-color: #ef4444; }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #D57A66;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .editable-content[contenteditable="true"] {
            outline: 2px solid #3B82F6;
            background-color: #EFF6FF;
            border-radius: 4px;
            padding: 2px 4px;
        }
        .card-edit-controls, .dialogue-item .delete-btn { display: none; }
        .is-editing .card-edit-controls, .is-editing .dialogue-item .delete-btn, .is-editing .add-dialogue-container { display: flex; }
        .is-editing .card-view-controls { display: none; }
    </style>
</head>
<body class="text-gray-800">
    <div id="app-container" class="container mx-auto p-4 md:p-8 max-w-7xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">煲養日記｜互動式拍攝腳本儀表板 ✨</h1>
            <p class="text-gray-500 mt-2">社群短影音詳細腳本 (7月第二週～第三週)</p>
        </header>

        <main>
            <!-- Always Visible Overview Section -->
            <section id="content-overview" class="mb-12">
                <div class="grid grid-cols-1 gap-8">
                    <div class="content-card p-6">
                        <h2 class="text-2xl font-bold mb-4">⭐ 拍攝事前準備提醒</h2>
                        <div class="space-y-4">
                            <div class="checklist-item p-2 rounded-md"><label class="flex items-start cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-orange-500 focus:ring-orange-400 mr-3 mt-1"><div class="flex-1"><span class="font-semibold text-gray-800 checklist-title">1. 腳本與內容確認</span><p class="ml-1 text-sm text-gray-600">所有腳本（包含對話、流程）已經定稿，並與 Hayley 老師及團隊全員確認。</p></div></label></div>
                            <div class="checklist-item p-2 rounded-md"><label class="flex items-start cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-orange-500 focus:ring-orange-400 mr-3 mt-1"><div class="flex-1"><span class="font-semibold text-gray-800 checklist-title">2. 場地與陳設準備</span><ul class="list-disc pl-6 mt-1 space-y-1 text-sm text-gray-600"><li><span class="font-bold">場地預約：</span>確認所有拍攝場地（室內廚房、攝影棚、戶外市場/餐廳）皆已預約及溝通完成。</li><li class="pl-4 text-gray-500">第一週-週五外出場地確認：待定</li><li class="pl-4 text-gray-500">第二週-週五外出場地確認：待定</li><li><span class="font-bold">環境佈置：</span>室內景確認背景陳設；廚房景確保乾淨整潔，鍋具餐具齊全。</li><li><span class="font-bold">道具準備：</span>除了食材，所有道具（特殊餐具、保溫壺、桌布等）皆已備妥。</li></ul></div></label></div>
                             <div class="checklist-item p-2 rounded-md"><label class="flex items-start cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-orange-500 focus:ring-orange-400 mr-3 mt-1"><div class="flex-1"><span class="font-semibold text-gray-800 checklist-title">3. 食材準備</span><div class="ml-1 text-sm text-gray-600 mt-1 space-y-2"><p><span class="font-bold">食材採購清單：</span>根據兩週的湯品內容，列出詳細採購清單。</p><div class="pl-4"><p class="font-semibold text-orange-600">第一週：響螺淮杞瘦肉湯</p><p class="pl-2">豬瘦肉半斤、淮山30克、枸杞10克、響螺1片、桂圓肉20克、薑切厚片約3片</p></div><div class="pl-4 mt-2"><p class="font-semibold text-orange-600">第二週：參朮天麻魚湯</p><p class="pl-2">當季魚1條、黨參10克、白朮10克、天麻20克、黃耆10克、陳皮半個、桂圓肉20克、薑切厚片約5片</p></div></div></div></label></div>
                             <div class="checklist-item p-2 rounded-md"><label class="flex items-start cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-orange-500 focus:ring-orange-400 mr-3 mt-1"><div class="flex-1"><span class="font-semibold text-gray-800 checklist-title">4. 器材與技術檢查</span><ul class="list-disc pl-6 mt-1 space-y-1 text-sm text-gray-600"><li><span class="font-bold">攝影器材：</span>確認相機、鏡頭、腳架、穩定器等設備功能正常。</li><li><span class="font-bold">電力與儲存：</span>所有電池充飽電，準備足夠備用電池及記憶卡。</li><li><span class="font-bold">收音設備：</span>測試所有麥克風，確保收音清晰無干擾。</li></ul></div></label></div>
                            <div class="checklist-item p-2 rounded-md"><label class="flex items-start cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-orange-500 focus:ring-orange-400 mr-3 mt-1"><div class="flex-1"><span class="font-semibold text-gray-800 checklist-title">5. 團隊與人員溝通</span><ul class="list-disc pl-6 mt-1 space-y-1 text-sm text-gray-600"><li>與 Hayley 老師確認好每一場景的服裝搭配。</li></ul></div></label></div>
                        </div>
                         <div class="mt-6 text-right">
                            <button id="reset-data-btn" class="text-xs text-red-500 hover:text-red-700 hover:underline">清除所有修改並重置</button>
                        </div>
                    </div>
                </div>
            </section>
            
            <nav id="main-nav-container" class="flex justify-center border-b border-gray-200 mb-8 items-center gap-2">
                <!-- Nav buttons will be inserted here -->
                <button id="add-week-btn" class="ml-4 px-3 py-1.5 bg-green-500 text-white rounded-full text-sm font-bold hover:bg-green-600 transition-colors">+ 新增一週</button>
            </nav>
            <div id="weeks-container">
                <!-- Week sections will be inserted here -->
            </div>
        </main>
    </div>

     <!-- Modal for AI Script Optimization -->
    <div id="ai-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col">
            <div class="p-4 border-b flex justify-between items-center">
                <h2 class="text-xl font-bold">✨ AI 腳本優化</h2>
                <button id="close-modal-btn" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
            </div>
            <div id="modal-body" class="p-6 overflow-y-auto">
                <!-- AI content will be injected here -->
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let weekCounter = 0;
            let scriptsData = {};
            const defaultScriptsData = {
                week1: { 
                    title: "第一週：情緒調理",
                    subtitle: "主打湯品：響螺淮杞瘦肉湯 (遠離憂鬱)",
                    days: {
                        mon: { title: '壓力山大emo了？Hayley老師爆肝社畜「情緒調理湯」讓你原地復活！', dialogue: [{ speaker: '掌鏡者', line: '老師你有聽過emo這個詞嗎， Blue Monday，感覺好多人心情很emo，提不起勁。', scene: 'Hayley 老師坐在光線柔和的環境中，表情關切，輕輕攪拌著一碗清澈的湯。', camera: '中景，營造對話的氛圍。' },{ speaker: 'Hayley 老師', line: '(輕柔而關切地) 是啊，我看到了。所以今天想跟大家聊一個很重要的概念：其實你的『脾氣』，很可能跟你的『脾胃』健康息息相關喔！', scene: '老師溫柔地看向鏡頭，像在與觀眾對話。可穿插「脾胃」與「大腦情緒」連結的簡易動畫。', camera: '近景，捕捉老師充滿同理心的眼神。' },{ speaker: '掌鏡者', line: '脾氣跟脾胃有關？這好神奇！', scene: '一樣對著老師。', camera: '近景，捕捉老師畫面。' },{ speaker: 'Hayley 老師', line: '在中醫裡，脾胃是『後天之本』。脾胃功能不好，氣血循環受影響，情緒自然容易波動。所以今天 Hayley 老師特別推薦『響螺淮杞瘦肉湯』。這碗湯能溫和地幫助脾胃運化，當身體得到滋養，心靈也會跟著放鬆，那些無謂的壓力和憂鬱自然就遠離了。', scene: '老師端起湯碗，輕輕品嚐一口，露出舒緩、放鬆的表情。', camera: '老師品嚐的特寫，再拉遠至胸上近景，傳達療癒感。' },{ speaker: '掌鏡者', line: '聽老師這樣一說，感覺喝完這碗湯，心裡真的平靜很多。', scene: '老師的畫面', camera: '中景' },{ speaker: 'Hayley 老師', line: '(溫暖地笑著，將湯碗往前輕推) 這就是煲湯的魔力，它不只溫暖你的胃，更能給你安定心神的力量。繼續關注我的影片，接下來也會帶著你做！', scene: '老師對著鏡頭做出加油打氣的手勢，或是溫暖地微笑點頭。', camera: '中景，老師與湯品都在畫面中，營造溫馨且充滿希望的結尾。' }] },
                        tue: { title: '神秘海洋食材大揭秘！「XXX」泡發後竟然是這樣？！', dialogue: [{ speaker: '掌鏡者', line: '老師，這看起來乾乾硬硬的，是什麼東西啊？', scene: '鏡頭對焦在 Hayley 老師雙手捧著的一塊乾燥、堅硬的響螺片上，畫面打馬賽克。', camera: '手部特寫。' },{ speaker: 'Hayley 老師', line: '(帶著一點考驗的表情) 各位湯品偵探們，今天 Hayley 老師又帶來一位神秘嘉賓！它來自廣闊深邃的大海，曬乾後硬邦邦的，給你們三秒來猜猜看是什麼呢？', scene: '老師將乾燥的響螺片在鏡頭前展示（打馬賽克），營造神秘感。', camera: '從手部特寫拉遠至老師的胸上近景。' },{ speaker: '掌鏡者', line: '老師！我猜是海帶', scene: '鏡頭一樣對著老師。', camera: '老師臉部表情特寫。' },{ speaker: 'Hayley 老師', line: '什麼海帶！觀眾猜到了嗎？沒錯，它就是我們煲『響螺淮杞瘦肉湯』的秘密武器——『響螺片』！', scene: '鏡頭一樣對著老師，再特寫食材。', camera: '老師臉部表情特寫。', countdown: true },{ speaker: '掌鏡者', line: '老師！怎麼跟在湯裡的時候長得不一樣啊', scene: '鏡頭一樣對著老師，附上湯品的圖片。', camera: '正對老師。' },{ speaker: 'Hayley 老師', line: '問得好！經過一番時間的浸泡…鏘鏘！泡發後它就會變成這樣！你看，是不是完全不一樣了？！飽滿、柔軟、又有彈性！', scene: '老師用手輕輕捏壓泡發後的響螺片，展示其彈性。', camera: '泡發前後的對比鏡頭，手部按壓的特寫。' },{ speaker: 'Hayley 老師', line: '明天我們要開始做這碗「響螺淮杞瘦肉湯」，每天準時關注老師的影片，帶你進入煲湯世界', scene: '老師自信的結尾。', camera: '胸上近景。' }] },
                        wed: { title: '沉浸式煲「響螺淮杞瘦肉湯」，療癒感爆棚！', dialogue: [{ speaker: '掌鏡者', line: '老師，今天終於要來煲這鍋米其林等級的響螺湯了！第一步要做什麼呢？', scene: '鏡頭掃過所有準備好的食材（泡發響螺片、淮山、杞子、瘦肉），畫面乾淨溫馨。', camera: '俯拍所有食材。' },{ speaker: 'Hayley 老師', line: '(精神飽滿地) 沒錯！今天 Hayley 老師就要帶大家，親手煲一鍋滋潤心靈的『響螺淮杞瘦肉湯』！首先最重要的就是食材的精準處理。像響螺片和瘦肉，都需要先用滾水川燙2-3分鐘，去除雜質和腥味。', scene: '老師示範將響螺片和瘦肉放入滾水中川燙，並撈去浮沫。', camera: '川燙及撈浮沫的動作特寫。' },{ speaker: '掌鏡者', line: '原來川燙這麼重要！那藥材呢？', scene: '鏡頭聚焦在清洗好的淮山和杞子上。', camera: '藥材的特寫。' },{ speaker: 'Hayley 老師', line: '淮山和杞子簡單清洗就好。然後把所有食材放入砂鍋，加水，大火煮沸後，立刻轉成小小的文火，蓋上鍋蓋，讓它慢慢地煲煮2個小時。', scene: '食材入鍋，加水，以及湯水從沸騰到文火慢燉的縮時攝影。', camera: '俯拍入鍋，側拍鍋內湯水變化。' },{ speaker: 'Hayley 老師', line: '(端起湯碗) 對吧！看看這碗湯，湯色清澈見底，喝上一口，那份溫潤與滋養直達心底，這就是真正的療癒系湯品！', scene: '老師將清澈的湯盛入碗中，閉眼聞香，再滿足地品嚐。', camera: '盛湯特寫，老師品嚐時享受的表情特寫。' }] },
                        thu: { title: '上班族「續命湯」街頭突襲！喝了這碗直接能量滿格？！', dialogue: [{ speaker: '掌鏡者', line: '老師，今天來到戶外，是準備要突襲上班族嗎？', scene: 'Hayley 老師提著保溫壺，自信地走在路上。', camera: '跟拍的中景鏡頭。' },{ speaker: 'Hayley 老師', line: '(面向鏡頭，眼神親切) 沒錯！嘿，各位奮鬥中的都市上班族們！Hayley 老師今天帶著這碗特別的『響螺淮杞瘦肉湯』，要來一場街頭突襲，看看這碗湯能不能讓他們直接『原地復活』！', scene: '老師對著鏡頭充滿活力地講解今天的任務。', camera: '老師的近景。' },{ speaker: '掌鏡者', line: '感覺會很有趣！我們邀請路人的時候要說什麼？', scene: '快速剪輯幾個上班族疲憊或趕路的畫面。', camera: '手持抓拍。' },{ speaker: 'Hayley 老師', line: '我們就問他：「您好！願意試喝一碗能幫您放鬆心情、提振精神的續命湯嗎？」', scene: '老師成功邀請到一位路人，並為他倒上一杯湯。', camera: '互動的中景。' },{ speaker: '反應剪輯', line: '路人畫面反應剪輯，依現場判斷問答', scene: '剪輯多位路人喝完湯後，從疲憊轉為驚訝、放鬆的表情變化。', camera: '多個反應的特寫快速剪輯。' },{ speaker: 'Hayley 老師', line: '看到我們的『響螺淮杞瘦肉湯』，是不是很想來一碗呢？快自己動手來做吧', scene: '老師在路上對著鏡頭說話。', camera: '中景特寫老師。' }] },
                        fri: { title: '外食族也能大口吃肉？Hayley老師的快樂擇食法！', dialogue: [{ speaker: '掌鏡者', line: '老師，很多粉絲都說自己是外食族，不知道怎麼吃才健康。今天是要帶我們去探訪什麼健康餐廳嗎？', scene: 'Hayley 老師走在街上，表情神秘地對鏡頭微笑。', camera: 'Vlog風格的跟拍視角。' },{ speaker: 'Hayley 老師', line: '今天帶你們來個特別的！誰說養生就不能吃自己喜歡的東西？走，我帶你們去我的秘密基地！', scene: '老師自信地一揮手，帶領鏡頭轉向一家炸雞店。', camera: '跟隨老師的視角，最後定格在炸雞店的招牌上。' },{ speaker: '掌鏡者', line: '（驚訝）雞塊？！老師，我們不是在聊健康飲食嗎？', scene: '鏡頭快速拉近掌鏡者，呈現驚訝的表情，再切到老師已經開心地在點餐。', camera: '快速剪輯。' },{ speaker: 'Hayley 老師', line: '(開心地拿起一塊雞塊) 你看，很多人都覺得養生就是要吃得很痛苦，不能碰這些美食。但你想想，如果為了健康，每天都強迫自己吃不喜歡的東西，心情會好嗎？', scene: '老師享受地吃著雞塊，與傳統養生形象形成反差萌。', camera: '老師用餐的近景，強調滿足的表情。' },{ speaker: 'Hayley 老師', line: '心情不好，壓力大，反而會給身心帶來負面影響。所以我的理念是，第一步，先讓自己的心態開心起來！先吃你喜歡吃的東西，再來慢慢調整飲食的內容與頻率，這才是能長久持續的煲養之道！', scene: '老師放下雞塊，真誠地面對鏡頭分享理念，背景是歡樂的用餐氛圍。', camera: '胸上近景，語氣誠懇，眼神真摯。' }] },
                        sat: { title: '夏季養生「黑科技」？！Hayley老師揭密「冬病夏治」驚人真相！', dialogue: [{ speaker: '掌鏡者', line: '老師，夏天這麼熱，除了多喝水，還有什麼更厲害的養生方法嗎？', scene: 'Hayley 老師坐在室內場景，表情專業。', camera: '中景。' },{ speaker: 'Hayley 老師', line: '(知性地) 問得好！今天，Hayley 老師要為大家揭開一個夏季養生的『黑科技』，聊聊一個更深層次的養生觀念——『冬病夏治』！', scene: '螢幕出現「冬病夏治」的書法字體動畫。', camera: '老師的近景。' },{ speaker: '掌鏡者', line: '冬病夏治？冬天生的病，夏天治？', scene: '鏡頭面對老師。', camera: '中景。' },{ speaker: 'Hayley 老師', line: '可以這麼說！中醫的『冬病夏治』，就是巧妙地利用夏季陽氣最旺盛的時候，來調理冬季容易發作的舊疾。特別是每年的『三伏天』，一年中最熱的時候，更是進行『冬病夏治』的最佳時機！這才是為長期的健康進行高回報的投資！', scene: '螢幕出現日曆，標示出「三伏天」的日期，並有太陽和火焰的動畫，強調陽氣旺盛。', camera: '老師的胸上近景，搭配動畫圖示輔助說明。' },{ speaker: '掌鏡者', line: '老師，破解了冬病夏治的觀念，那有沒有什麼適合夏天，特別是小朋友放暑假可以喝的湯品呢？', scene: '鏡頭一樣對著老師。', camera: '近景。' },{ speaker: 'Hayley 老師', line: '你問到重點了！夏天養生，我會特別推薦一道『山藥茯苓雪耳瘦肉湯』，它能清熱化濕、健脾養胃，非常適合暑假容易中暑或食慾不振的大小朋友。', scene: '螢幕上出現「山藥茯苓雪耳瘦肉湯」的精美字卡，並搭配食材的圖片。', camera: '老師介紹時，保持近景。' },{ speaker: 'Hayley 老師', line: '大家會想看我做嗎？快在下面留言告訴我！', scene: '老師俏皮地對著鏡頭眨眼，做出邀請的手勢。', camera: '胸上近景，與觀眾互動感強。' }] },
                        sun: { title: '煲湯食材到底要不要切？老師救救我！整顆馬鈴薯我該怎麼吃？！', dialogue: [{ speaker: '掌鏡者', line: '老師，我看到有粉絲私訊一個問題，說他照妳說的『食材切大塊比較好』，結果丟了一整顆馬鈴薯進去，現在問要怎麼吃？', scene: 'Hayley老師看著手機，露出又好氣又好笑的表情。螢幕上可以疊加粉絲私訊的模擬對話框。', camera: '中景，捕捉老師的生動表情。' },{ speaker: 'Hayley 老師', line: '(哭笑不得地) 沒錯！今天就是要來破解這個美麗的誤會！我常說煲原型食物的湯，食材可以切大塊一點，避免煮爛。但『大塊』不等於『整顆丟進去』啊！你看，像這樣...', scene: '用動畫來表現這個有趣的內容。', camera: '老師近景，然後鏡頭快速切到NG湯鍋的特寫。' },{ speaker: '掌鏡者', line: '天啊！這真的太誇張了！那到底該怎麼切才對？', scene: '老師對著鏡頭的畫面。', camera: '老師半身畫面。' },{ speaker: 'Hayley 老師', line: '所謂的「切大塊」，是像這樣！', scene: '用動畫來表現這個有趣的內容。', camera: '老師半身畫面。' },{ speaker: 'Hayley 老師', line: '(總結) 所以記住了嗎？原型食物煲湯，切大塊是為了保留口感和營養，但前提是要能方便入口呀！千萬不要再整顆丟進去了，不然神仙也難救喔！', scene: '老師對著鏡頭的畫面。', camera: '老師半身畫面。' }] }
                    }
                },
                week2: {
                    title: "第二週：事業鴻圖",
                    subtitle: "主打湯品：參朮天麻魚湯 (預防失智，助事業大展鴻圖)",
                    days: {
                        mon: { title: '大展鴻圖能做成湯嗎？Hayley老師：參朮天麻魚湯！', dialogue: [{ speaker: '掌鏡者', line: '老師，最近有一首歌超紅的，你有沒有聽過？我播給你聽看看。', scene: 'Hayley 老師坐在佈置溫馨的書房，表情有點好奇地看著掌鏡者。', camera: '中景。' },{ speaker: 'Hayley 老師', line: '好啊！什麼歌這麼神秘，播來聽聽看。', scene: '老師輕鬆地靠在椅子上，做出洗耳恭聽的樣子。', camera: '近景，捕捉老師期待的表情。' },{ speaker: '播放音樂', line: '(播放音樂《大展鴻圖》副歌)', scene: '可以是音樂播放的波形動畫，或是老師專心聽歌的畫面，隨著節奏微微點頭。', camera: '老師的特寫或音樂視覺化動畫。' },{ speaker: '掌鏡者', line: '老師聽完後有沒有什麼感想？', scene: '老師聽完後露出會心一笑，若有所思。', camera: '中景。' },{ speaker: 'Hayley 老師', line: '旋律很振奮人心，歌詞也很有氣勢，難怪會這麼紅。', scene: '老師點點頭，表示認同。', camera: '近景。' },{ speaker: '掌鏡者', line: '那...我們今天就要給老師一個任務！就是要你用這首歌做一碗煲湯！', scene: '掌鏡者用挑戰的語氣說話，鏡頭可以稍微晃動增加趣味性。', camera: '掌鏡者主觀視角，或是帶到老師有點驚訝又覺得有趣的表情。' },{ speaker: 'Hayley 老師', line: '(思考了一下，然後眼睛一亮) 用《大展鴻圖》做湯...有意思！要大展鴻圖...我想到了！就決定是『參朮天麻魚湯』！', scene: '老師從思考到靈光一閃的過程，可以加上燈泡亮起的音效或動畫。最後自信地說出湯品名稱。', camera: '老師表情的特寫。' },{ speaker: '掌鏡者', line: '哇！聽起來就好厲害！這碗湯要怎麼幫助大家呢？', scene: '鏡頭聚焦在老師自信的臉上。', camera: '近景。' },{ speaker: 'Hayley 老師', line: '這碗湯不只能補腦、增強記憶力，還能幫你補足元氣，讓你思路清晰，工作就像開外掛！想知道怎麼做嗎？記得關注我們週三的影片喔！', scene: '老師對著鏡頭俏皮地眨眼，賣個關子。', camera: '胸上近景。' }] },
                        tue: { title: '職場智囊團召集！猜猜「神補魚湯」裡的哪味藥材讓你腦力全開？', dialogue: [{ speaker: '掌鏡者', line: '老師，你手上拿的是什麼啊？', scene: 'Hayley 老師手中拿著一塊天麻，打馬賽克，對鏡頭神秘地微笑。', camera: '手部特寫，焦點在半遮半露的食材上。' },{ speaker: 'Hayley 老師', line: '(俏皮地微笑) 欸～今天我要來考考我們職場智囊團的成員們，這可是能讓大腦思緒『如魚得水』，在職場上『大展鴻圖』的秘密武器！', scene: '老師將食材稍微轉動，但仍不完全展示，表情充滿引導性。', camera: '從手部特寫拉遠至老師的胸上近景。' },{ speaker: '掌鏡者', line: '這麼厲害？有什麼提示嗎？', scene: '螢幕上出現「提示」的趣味字卡。', camera: '保持老師的胸上近景。' },{ speaker: 'Hayley 老師', line: '提示就是一片一片！猜到了嗎？', scene: '穿插簡易動畫。', camera: '老師講解時為近景，穿插動畫時可全螢幕呈現。' },{ speaker: '掌鏡者', line: '嗯...有點難，該不會是馬鈴薯！', scene: '鏡頭回到老師身上，她做出準備揭曉答案的表情。', camera: '中景。' },{ speaker: 'Hayley 老師', line: '(揭曉答案) 好吧！它就是我們『參朮天麻魚湯』裡的靈魂主角——『天麻』！', scene: '老師將天麻完整展示在鏡頭前，螢幕下方出現「天麻」的品名字卡與趣味圖示。', camera: '食材的特寫，焦點清晰。', countdown: true },{ speaker: '掌鏡者', line: '哇！原來是天麻！真的是長知識了。沒想到它跟『大展鴻圖』還有這種關聯。', scene: '鏡頭一樣對著老師，老師自信地點點頭。', camera: '近景。' },{ speaker: 'Hayley 老師', line: '對啊！所以說食材的背後都有很多有趣的故事和智慧。想知道這碗能讓你『大展鴻圖』的參朮天麻魚湯要怎麼煲嗎？記得鎖定明天的影片喔！', scene: '老師拿著天麻，對鏡頭俏皮地賣個關子，並做出「明天見」的手勢。', camera: '胸上近景。' }] },
                        wed: { title: 'Hayley老師手把手教你煲，喝出你的大展鴻圖！', dialogue: [{ speaker: '片頭', line: '快速剪輯製作畫面作為片頭，背景用大展鴻圖的音樂', scene: '', camera: ''},{ speaker: '掌鏡者', line: '老師，昨天介紹完天麻，今天就要實際來煲這碗『大展鴻圖湯』了嗎？看起來材料好豐富！', scene: '鏡頭掃過所有準備好的食材（鱸魚、天麻、黨參、白朮等），整齊排列在流理台上。', camera: '俯拍所有食材。' },{ speaker: 'Hayley 老師', line: '(精神飽滿地) 沒錯！今天就要手把手教各位渴望職場晉升的戰士們，煲這碗能助你『大展鴻圖』的『參朮天麻魚湯』！…首先第一步，處理鱸魚，記得要用廚房紙巾吸乾水份，兩面煎到金黃！', scene: '老師示範用紙巾吸乾魚身水份，並將魚放入熱鍋中煎，發出滋滋聲。', camera: '處理手法的特寫和煎魚時的平拍特寫。' },{ speaker: '掌鏡者', line: '為什麼煎魚這麼重要啊？', scene: '魚皮呈現金黃色，香氣四溢。', camera: '鍋內魚的特寫鏡頭。' },{ speaker: 'Hayley 老師', line: '這一步非常關鍵！它能鎖住魚的鮮味，也能讓湯色變得奶白濃郁，像智慧的光芒一樣漂亮喔！接著，就是我們這碗湯的精髓：天麻、黨參、白朮這些珍貴的藥材。', scene: '老師將鏡頭轉向旁邊已清洗好的藥材，並簡單介紹。', camera: '藥材的特寫鏡頭。' },{ speaker: '掌鏡者', line: '哇，那接下來呢？', scene: '老師將所有食材依序放入砂鍋中。', camera: '側拍或俯拍食材入鍋的畫面，可使用慢動作。' },{ speaker: 'Hayley 老師', line: '把所有食材一同放入砂鍋，加水，大火煮沸後轉文火慢燉兩個小時。這個等待就像為事業積蓄能量，不能心急！', scene: '湯水由大火沸騰轉為文火咕嘟冒泡的縮時攝影或特寫。', camera: '鍋內湯水變化的特寫。' },{ speaker: 'Hayley 老師', line: '(盛湯)瞧！一碗充滿智慧與能量的『參朮天麻魚湯』就大功告成了！喝了保證你決策力UP！UP！UP！', scene: '老師將奶白色的湯盛入碗中，端起對鏡頭自信微笑。', camera: '盛湯特寫，最後回到老師的胸上近景。' }] },
                        thu: { title: '街頭盲測！這碗「開智慧魚湯」讓路人反應太驚人！', dialogue: [{ speaker: '掌鏡者', line: '老師，我們今天真的要把這鍋『參朮天麻魚湯』帶到街上給大家盲測嗎？不知道大家反應會怎麼樣？', scene: 'Hayley 老師提著時尚的保溫壺，站在人來人往的熱鬧街頭（例如西門町、信義區），背景是各式各樣的路人。', camera: '廣角中景，展現街頭的活力與人潮。' },{ speaker: 'Hayley 老師', line: '(眼神親切而帶點挑戰意味) 當然！好東西就是要分享！今天我們就要來看看，這碗能讓思緒清晰的『開智慧魚湯』，會給大家帶來什麼樣的驚喜！', scene: '老師對著鏡頭自信地拍拍保溫壺，做出「出任務」的俏皮手勢。', camera: '老師的近景。' },{ speaker: '掌鏡者', line: '好！那我們要怎麼邀請路人呢？', scene: '快速剪輯幾個路人走過、好奇張望的畫面。', camera: '手持跟拍的視角。' },{ speaker: 'Hayley 老師', line: '我們就大方地問：「您好！我們是煲養日記，想邀請您試喝一碗很特別的湯，幫我們盲測看看是什麼味道好嗎？」', scene: '老師面帶微笑，親切地向一位路人遞出小湯杯。', camera: '互動的中景，捕捉雙方表情。' },{ speaker: '掌鏡者', line: '他們喝完之後，我們要問他們什麼問題？', scene: '路人品嚐湯品後，露出思考、驚訝、或滿意的表情。', camera: '路人表情的特寫。' },{ speaker: 'Hayley 老師', line: '當然是問他們喝起來感覺怎麼樣？有沒有覺得精神比較好、頭腦好像轉得比較快？猜不猜得出來裡面有什麼特別的食材？', scene: '穿插不同路人分享感想的片段（例如：「嗯？味道很甘甜」、「感覺頭腦真的有比較清醒耶！」、「裡面是有加魚嗎？」），可搭配趣味的動畫效果。', camera: '快速剪輯多位路人的反應特寫。' }] },
                        fri: { title: '煲湯不只養身，更要養心！Hayley老師的大展鴻圖之道', dialogue: [{ speaker: '掌鏡者', line: '老師，這週我們從《大展鴻圖》這首歌開始，學了湯、也認識了食材，感覺收穫滿滿！', scene: 'Hayley老師坐在溫馨的書房場景，面前放著一碗清澈的參朮天麻魚湯，臉上帶著滿足的微笑。', camera: '中景，營造一個總結、聊天的氛圍。' },{ speaker: 'Hayley 老師', line: '對啊！這整個禮拜，我們其實不只在學怎麼煲一碗湯。', scene: '老師輕輕拿起湯匙，攪動碗裡的湯，眼神專注而溫柔。', camera: '近景，聚焦在老師和湯碗上。' },{ speaker: '掌鏡者', line: '哦？那老師覺得我們還學到了什麼？', scene: '鏡頭回到老師身上。', camera: '保持近景。' },{ speaker: 'Hayley 老師', line: '我們學到的是，想要在事業上『大展鴻圖』，不能只靠拼命。就像煲湯一樣，你需要懂得選擇對的材料、用對的方法，還要有耐心。把自己的身體當作最重要的事業來經營，先把自己『煲』好了，才有力氣去追求更大的目標。', scene: '老師的表情變得懇切而真誠，眼神充滿智慧的光芒，可以穿插本週一到四的重點畫面快閃回顧。', camera: '胸上近景，強調老師分享人生哲理的感覺。' },{ speaker: 'Hayley 老師', line: '所以，煲湯不只是養身，更是在養心。希望這週的『大展鴻圖湯』，能給大家帶來滿滿的能量！', scene: '老師端起湯碗，對著鏡頭自信地微笑，做出一個「加油」的手勢。', camera: '中景，給予觀眾正面積極的鼓勵。' }] },
                        sat: { title: '震驚！「天麻」竟是煲湯界頂流？你不知道的「毒性」真相大公開！', dialogue: [{ speaker: '掌鏡者', line: '老師，很多粉絲都在問，天麻是不是有毒啊？聽說不能亂吃。', scene: 'Hayley 老師坐在佈置簡潔的書桌前，表情嚴肅，手旁放著天麻實物。', camera: '中景，營造知識分享的氛圍。' },{ speaker: 'Hayley 老師', line: '(表情認真) 這個問題問得非常好！我常聽到一個流傳已久的都市傳說：『天麻有毒，不能亂吃！』今天，Hayley 老師就來為大家破解這個迷思！', scene: '螢幕上出現「天麻有毒？」的懸念字卡，並打上一個大大的問號。', camera: '老師的近景。' },{ speaker: '掌鏡者', line: '所以是真的還是假的？', scene: '鏡頭聚焦在老師準備解答的表情上。', camera: '保持近景。' },{ speaker: 'Hayley 老師', line: '假的！其實啊，天麻本身是沒有毒性的！它是一種非常珍貴的中藥材，被譽為『中醫腦部養生聖品』。會出問題，關鍵真的在於『對症使用』和『適量』！只要是在專業指導下，或是依照正規食譜適量煲煮，天麻絕對是安全又滋補的好食材！', scene: '畫面中的問號被打叉，並出現「安全」的綠色打勾圖示。穿插天麻功效（如平肝息風）的簡潔動畫。', camera: '胸上近景，強調老師的專業與權威感。' },{ speaker: '掌鏡者', line: '哇，原來是這樣！又破解了一個迷思。看來只要用對方法，就不用害怕這些珍貴的藥材了。', scene: '掌鏡者點頭，做出恍然大悟的表情。', camera: '掌鏡者的主觀視角或是切一個掌鏡者的反應鏡頭。' },{ speaker: 'Hayley 老師', line: '沒錯！養生的智慧就在於了解食材、正確使用。下次煲湯，大家就可以安心地加入天麻，為自己和家人的腦力加分了！', scene: '老師自信地拿起天麻，對著鏡頭微笑。', camera: '胸上近景，給觀眾帶來信任感。' }] },
                        sun: { title: '你的魚湯為什麼總被嫌棄？煲湯車禍現場！Hayley老師實測NG秘訣！', dialogue: [{ speaker: '掌鏡者', line: '老師，聽說煲魚湯很容易有腥味，是為什麼啊？', scene: 'Hayley 老師站著，表情專業地準備解答。', camera: '中景。' },{ speaker: 'Hayley 老師', line: '(表情嚴肅) 沒錯！今天 Hayley 老師就要來破解煲魚湯的『大忌』，很多人就是犯了這個錯，才把好好的魚湯變成『煲湯車禍現場』！', scene: '旁邊出現動畫：一鍋冒著骷髏頭黑煙的「NG魚湯」，搭配「車禍現場」的震撼字卡。', camera: '老師的近景。' },{ speaker: '掌鏡者', line: '是什麼大忌啊？難道是魚沒洗乾淨嗎？', scene: '老師畫面。', camera: '中景。' },{ speaker: 'Hayley 老師', line: '問題就在這裡！為了省事，直接把魚丟下去煮，結果湯不夠鮮甜，腥味重！其實煲魚湯，有個非常、非常關鍵的步驟，就是『先煎魚』！把魚兩面煎到金黃焦香，煲出來的湯色才會是漂亮的奶白色，清甜又好喝！', scene: '用煎魚的畫面放在畫面中。', camera: '中景。' },{ speaker: '掌鏡者', line: '哇！原來煎魚這一步這麼重要，難怪我之前煲的魚湯都有一點點腥味。', scene: '切換到一個完美奶白魚湯的誘人動畫，湯面上冒著愛心形狀的熱氣。', camera: '全螢幕動畫。' },{ speaker: 'Hayley 老師', line: '(畫外音，語氣充滿自信)沒錯！煲湯的美味就藏在這些小細節裡。學會了這個秘訣，以後你也能輕鬆煲出零失敗的魚湯！', scene: '老師自信地對著鏡頭微笑，做出「你也可以」的手勢。', camera: '中景。' }] }
                    }
                }
            };
            
            function createDialogueHTML(dialogueArray, isEditing) {
                let html = '<div class="dialogue-list space-y-4">';
                (dialogueArray || []).forEach((item, index) => {
                    html += `
                        <div class="dialogue-item flex items-start space-x-4">
                            <div class="dialogue-number">${index + 1}</div>
                            <div class="flex-1">
                                <p class="font-semibold text-gray-800 editable-content" contenteditable="${isEditing}"><span class="speaker-name">${item.speaker}</span>: <span class="line-content">${item.line}</span></p>
                                <div class="mt-2 text-sm text-gray-500">
                                    <p class="editable-content" contenteditable="${isEditing}"><span class="font-semibold">畫面：</span> <span class="scene-content">${item.scene || ''}</span></p>
                                    <p class="editable-content" contenteditable="${isEditing}"><span class="font-semibold">鏡位：</span> <span class="camera-content">${item.camera || ''}</span></p>
                                </div>
                            </div>
                            <button data-action="delete-dialogue" class="delete-btn rounded-full w-6 h-6 flex-shrink-0 items-center justify-center text-xs font-bold edit-controls">-</button>
                        </div>`;
                });
                html += '</div>';
                return html;
            }

            function generateDayContent(week, day) {
                const dayData = scriptsData[week].days[day];
                if (!dayData) return '<p>無此日腳本。</p>';
                
                let contentHTML = `
                    <div id="${week}-${day}" class="day-content content-card p-6">
                        <h3 class="text-xl font-bold mb-4 text-orange-600 editable-content" contenteditable="false">${dayData.title}</h3>
                        ${createDialogueHTML(dayData.dialogue, false)}
                         <div class="mt-4 edit-controls add-dialogue-container">
                            <button data-action="add-dialogue" class="edit-btn text-sm font-semibold px-3 py-1 rounded-lg">+ 新增對白</button>
                        </div>
                        <div class="border-t mt-4 pt-4 flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <button data-action="optimize" data-week="${week}" data-day="${day}" class="gemini-btn flex items-center gap-2 px-4 py-2 rounded-lg font-semibold text-sm transition-transform transform hover:scale-105">✨ 優化腳本</button>
                                <button data-action="hashtag" data-week="${week}" data-day="${day}" class="gemini-btn flex items-center gap-2 px-4 py-2 rounded-lg font-semibold text-sm transition-transform transform hover:scale-105">✨ 產生Hashtag</button>
                                <div class="loader hidden"></div>
                            </div>
                            <div class="card-view-controls">
                                <button data-action="edit" class="edit-btn-main flex items-center gap-2 px-4 py-2 rounded-lg font-semibold text-sm">✏️ 編輯</button>
                            </div>
                            <div class="card-edit-controls items-center gap-4">
                               <button data-action="save" data-week="${week}" data-day="${day}" class="save-btn flex items-center gap-2 px-4 py-2 rounded-lg font-semibold text-sm">✅ 完成儲存</button>
                               <button data-action="cancel" data-week="${week}" data-day="${day}" class="cancel-btn flex items-center gap-2 px-4 py-2 rounded-lg font-semibold text-sm">❌ 取消</button>
                            </div>
                        </div>
                        <div id="hashtag-result-${week}-${day}" class="mt-4 hidden"></div>
                    </div>`;
                return contentHTML;
            }
            
            function setCardEditState(card, isEditing) {
                card.classList.toggle('is-editing', isEditing);
                card.querySelectorAll('.editable-content').forEach(el => {
                    el.setAttribute('contenteditable', isEditing);
                });
                if (isEditing) {
                    card.querySelector('.editable-content')?.focus();
                }
            }
            
            function saveCardChanges(card, week, day) {
                const title = card.querySelector('h3').textContent;
                const dialogueItems = card.querySelectorAll('.dialogue-item');
                const newDialogue = [];
                dialogueItems.forEach(item => {
                    const speaker = item.querySelector('.speaker-name').textContent;
                    const line = item.querySelector('.line-content').textContent;
                    const scene = item.querySelector('.scene-content').textContent;
                    const camera = item.querySelector('.camera-content').textContent;
                    newDialogue.push({ speaker, line, scene, camera });
                });
                scriptsData[week].days[day] = { title, dialogue: newDialogue };
                localStorage.setItem('hayleyScriptsData', JSON.stringify(scriptsData));
                setCardEditState(card, false);
            }
            
            function cancelCardChanges(card, week, day) {
                const currentWeekNav = document.getElementById(`${week}-nav`);
                const activeDayBtn = currentWeekNav.querySelector('button.active');
                if (activeDayBtn) {
                    activeDayBtn.click();
                }
            }

            function setupWeek(weekKey) {
                const navContainer = document.getElementById(`${weekKey}-nav`);
                const contentContainer = document.getElementById(`${weekKey}-content`);

                navContainer.addEventListener('click', function(e) {
                    if (e.target.tagName === 'BUTTON') {
                        const day = e.target.dataset.day;
                        navContainer.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
                        e.target.classList.add('active');
                        contentContainer.innerHTML = generateDayContent(weekKey, day);
                    }
                });
                
                const defaultDayButton = navContainer.querySelector('button[data-day="mon"]');
                if (defaultDayButton) defaultDayButton.click();
            }

            function createNewWeekSection(weekNum) {
                const weekKey = `week${weekNum}`;
                const navContainer = document.getElementById('main-nav-container');
                const addBtn = document.getElementById('add-week-btn');
                const newNavBtn = document.createElement('button');
                newNavBtn.id = `nav-${weekKey}`;
                newNavBtn.className = 'main-nav-btn px-4 py-3 text-lg font-medium text-gray-500';
                newNavBtn.textContent = `第 ${weekNum} 週`;
                navContainer.insertBefore(newNavBtn, addBtn);

                const newSection = document.createElement('section');
                newSection.id = `content-${weekKey}`;
                newSection.className = 'hidden';
                newSection.innerHTML = `
                    <div class="text-center mb-6">
                        <h2 class="text-2xl font-bold editable-content" contenteditable="false">第 ${weekNum} 週：新主題</h2>
                        <p class="text-gray-600 mt-1 editable-content" contenteditable="false">主打湯品：點此編輯</p>
                    </div>
                    <div id="${weekKey}-nav" class="flex flex-wrap justify-center gap-2 mb-8">
                         ${['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun'].map(day => `<button data-day="${day}" class="week-nav-btn px-4 py-2 rounded-full font-medium bg-white border">${day.replace('mon','週一').replace('tue','週二').replace('wed','週三').replace('thu','週四').replace('fri','週五').replace('sat','週六').replace('sun','週日')}</button>`).join('')}
                    </div>
                    <div id="${weekKey}-content" class="space-y-6"></div>
                `;
                document.getElementById('weeks-container').appendChild(newSection);

                scriptsData[weekKey] = {
                    title: `第 ${weekNum} 週`,
                    subtitle: `主打湯品：點此編輯`,
                    days: {}
                };
                ['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun'].forEach(day => {
                    scriptsData[weekKey].days[day] = {
                        title: `第 ${weekNum} 週，${day.replace('mon','週一')} - 點此編輯標題`,
                        dialogue: [{ speaker: '講者', line: '點此編輯對話內容', scene: '點此編輯場景描述', camera: '點此編輯鏡位描述' }]
                    };
                });
                
                newNavBtn.addEventListener('click', () => switchMainTab(weekKey));
                setupWeek(weekKey);
                localStorage.setItem('hayleyScriptsData', JSON.stringify(scriptsData));
                newNavBtn.click();
            }
            
            function switchMainTab(activeTabKey) {
                 document.querySelectorAll('#weeks-container > section').forEach(sec => sec.classList.add('hidden'));
                 document.querySelectorAll('#main-nav-container button.main-nav-btn').forEach(btn => btn.classList.remove('active'));
                 document.getElementById(`content-${activeTabKey}`).classList.remove('hidden');
                 document.getElementById(`nav-${activeTabKey}`).classList.add('active');
            }

            function initializeApp() {
                const savedData = localStorage.getItem('hayleyScriptsData');
                if (savedData) {
                    scriptsData = JSON.parse(savedData);
                } else {
                    scriptsData = defaultScriptsData;
                }
                
                const navContainer = document.getElementById('main-nav-container');
                const addBtn = document.getElementById('add-week-btn');
                navContainer.innerHTML = ''; // Clear existing
                navContainer.appendChild(addBtn);

                const weeksContainer = document.getElementById('weeks-container');
                weeksContainer.innerHTML = '';


                Object.keys(scriptsData).forEach(weekKey => {
                    weekCounter = Math.max(weekCounter, parseInt(weekKey.replace('week', '')));
                    const weekData = scriptsData[weekKey];
                    const navBtn = document.createElement('button');
                    navBtn.id = `nav-${weekKey}`;
                    navBtn.className = 'main-nav-btn px-4 py-3 text-lg font-medium text-gray-500';
                    navBtn.textContent = weekData.title;
                    navBtn.addEventListener('click', () => switchMainTab(weekKey));
                    navContainer.insertBefore(navBtn, addBtn);

                    const section = document.createElement('section');
                    section.id = `content-${weekKey}`;
                    section.className = 'hidden';
                    section.innerHTML = `
                        <div class="text-center mb-6">
                            <h2 class="text-2xl font-bold editable-content" contenteditable="false">${weekData.title}</h2>
                            <p class="text-gray-600 mt-1 editable-content" contenteditable="false">${weekData.subtitle}</p>
                        </div>
                        <div id="${weekKey}-nav" class="flex flex-wrap justify-center gap-2 mb-8">
                            ${Object.keys(weekData.days).map(day => `<button data-day="${day}" class="week-nav-btn px-4 py-2 rounded-full font-medium bg-white border">${day.replace('mon','週一').replace('tue','週二').replace('wed','週三').replace('thu','週四').replace('fri','週五').replace('sat','週六').replace('sun','週日')}</button>`).join('')}
                        </div>
                        <div id="${weekKey}-content" class="space-y-6"></div>
                    `;
                    weeksContainer.appendChild(section);
                    setupWeek(weekKey);
                });
                
                document.getElementById('nav-week1')?.click();
            }

            document.getElementById('add-week-btn').addEventListener('click', () => createNewWeekSection(weekCounter + 1));
            
            document.getElementById('weeks-container').addEventListener('click', function(e) {
                const button = e.target.closest('button[data-action]');
                if (!button) return;

                const card = button.closest('.day-content');
                const week = card.id.split('-')[0];
                const day = card.id.split('-')[1];

                switch (button.dataset.action) {
                    case 'edit': setCardEditState(card, true); break;
                    case 'save': saveCardChanges(card, week, day); break;
                    case 'cancel': cancelCardChanges(card, week, day); break;
                    case 'add-dialogue':
                        const dialogueList = card.querySelector('.dialogue-list');
                        const newItem = document.createElement('div');
                        newItem.className = 'dialogue-item flex items-start space-x-4';
                        newItem.innerHTML = `
                            <div class="dialogue-number">${dialogueList.children.length + 1}</div>
                            <div class="flex-1">
                                <p class="font-semibold text-gray-800 editable-content" contenteditable="true"><span class="speaker-name">新講者</span>: <span class="line-content">新增對白</span></p>
                                <div class="mt-2 text-sm text-gray-500">
                                    <p class="editable-content" contenteditable="true"><span class="font-semibold">畫面：</span> </p>
                                    <p class="editable-content" contenteditable="true"><span class="font-semibold">鏡位：</span> </p>
                                </div>
                            </div>
                            <button data-action="delete-dialogue" class="delete-btn rounded-full w-6 h-6 flex-shrink-0 items-center justify-center text-xs font-bold edit-controls">-</button>`;
                        dialogueList.appendChild(newItem);
                        break;
                    case 'delete-dialogue':
                        const itemToDelete = button.closest('.dialogue-item');
                        const list = itemToDelete.parentElement;
                        itemToDelete.remove();
                        list.querySelectorAll('.dialogue-item').forEach((item, index) => {
                            item.querySelector('.dialogue-number').textContent = index + 1;
                        });
                        break;
                    case 'optimize': case 'hashtag':
                        handleGeminiAction(action, week, day, button);
                        break;
                }
            });

            document.getElementById('reset-data-btn').addEventListener('click', () => {
                if(confirm('您確定要清除所有修改並重置為原始腳本嗎？此操作無法復原。')) {
                    localStorage.removeItem('hayleyScriptsData');
                    location.reload();
                }
            });

            const modal = document.getElementById('ai-modal');
            const closeModalBtn = document.getElementById('close-modal-btn');
            closeModalBtn.addEventListener('click', () => modal.classList.add('hidden'));
            modal.addEventListener('click', (e) => { if(e.target === modal) modal.classList.add('hidden'); });

            async function handleGeminiAction(action, week, day, button) {
                const card = button.closest('.day-content');
                const title = card.querySelector('h3').textContent;
                const dialogueElements = card.querySelectorAll('.dialogue-item p.font-semibold');
                const dialogueText = Array.from(dialogueElements).map(p => p.textContent).join('\n');
                let prompt = '';
                const loader = card.querySelector('.loader');
                loader.classList.remove('hidden');
                button.disabled = true;

                if (action === 'optimize') {
                    prompt = `你是一位專業的短影音腳本編劇。請優化以下對話腳本，使其對於社群媒體觀眾（如TikTok/Instagram Reels）更具吸引力、風趣且自然。請保持原講者Hayley老師（一位溫暖且知識淵博的煲湯專家）的核心訊息與語氣。\n\n原始腳本：\n${dialogueText}`;
                    const resultText = await callGeminiAPI(prompt);
                    showOptimizationResult(dialogueText, resultText);
                } else if (action === 'hashtag') {
                    prompt = `根據這段影片腳本的標題「${title}」和對話內容「${dialogueText}」，為Instagram和TikTok等社群平台生成15個相關且熱門的hashtags。請專注於湯品、健康、養生、特定食材以及影片主題等關鍵字。請用繁體中文，並以逗號分隔。`;
                    const resultText = await callGeminiAPI(prompt);
                    showHashtagResult(resultText, week, day);
                }
                
                loader.classList.add('hidden');
                button.disabled = false;
            }
            
            async function callGeminiAPI(prompt) {
                 const apiKey = ""; 
                 const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                 try {
                     const response = await fetch(apiUrl, {
                         method: 'POST',
                         headers: { 'Content-Type': 'application/json' },
                         body: JSON.stringify({ contents: [{ role: "user", parts: [{ text: prompt }] }] })
                     });
                     if (!response.ok) throw new Error(`API 請求失敗，狀態碼： ${response.status}`);
                     const result = await response.json();
                     if (result.candidates && result.candidates.length > 0) return result.candidates[0].content.parts[0].text;
                     return "AI無法生成回應，請稍後再試。";
                 } catch (error) {
                     console.error("Gemini API call failed:", error);
                     return `發生錯誤： ${error.message}`;
                 }
            }
            
            function showOptimizationResult(original, optimized) {
                const modalBody = document.getElementById('modal-body');
                modalBody.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-bold text-lg mb-2">原始腳本</h4>
                            <div class="bg-gray-100 p-4 rounded-lg whitespace-pre-wrap text-sm max-h-[60vh] overflow-y-auto">${original}</div>
                        </div>
                        <div>
                            <h4 class="font-bold text-lg mb-2">✨ AI 優化版</h4>
                            <div class="bg-orange-50 p-4 rounded-lg whitespace-pre-wrap text-sm max-h-[60vh] overflow-y-auto">${optimized}</div>
                        </div>
                    </div>
                `;
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            }
            
            function showHashtagResult(hashtags, week, day) {
                const resultContainer = document.getElementById(`hashtag-result-${week}-${day}`);
                const hashtagArray = hashtags.split(/[,，#\s]+/).map(h => h.trim()).filter(h => h);
                let html = `<div class="font-semibold mb-2">AI 建議 Hashtags：</div><div class="flex flex-wrap gap-2">`;
                hashtagArray.forEach(tag => {
                    html += `<span class="hashtag px-3 py-1 rounded-full text-sm">#${tag}</span>`;
                });
                html += `</div>`;
                resultContainer.innerHTML = html;
                resultContainer.classList.remove('hidden');
            }

            initializeApp();
        });
    </script>
</body>
</html>
